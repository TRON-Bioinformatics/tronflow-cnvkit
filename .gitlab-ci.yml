image: amazoncorretto:17.0.6

variables:
  GIT_SUBMODULE_STRATEGY: recursive

before_script:
  # check java version of docker image
  - java -version
  # install system dependencies
  - yum install -y wget which make procps-ng shadow-utils git gcc gcc-c++ cmake
  # install nextflow
  - wget -qO- https://get.nextflow.io | bash && cp nextflow /usr/local/bin/nextflow
  - which nextflow
  # install mamba
  - wget https://github.com/conda-forge/miniforge/releases/latest/download/Mambaforge-Linux-x86_64.sh
  - mkdir /root/.conda
  - bash Mambaforge-Linux-x86_64.sh -b -p /usr/local/bin/conda
  - rm -f Mambaforge-Linux-x86_64.sh
  - source /usr/local/bin/conda/etc/profile.d/conda.sh
  - source /usr/local/bin/conda/etc/profile.d/mamba.sh
  - which mamba 
  - mamba --version
  # this is a workaround for https://github.com/mamba-org/mamba/issues/1993
  - echo "use_lockfiles:" >> ~/.condarc
  - echo "  - false" >> ~/.condarc
  - echo "channels:" >> ~/.condarc
  - echo "  - defaults" >> ~/.condarc
  - echo "  - conda-forge" >> ~/.condarc
  - echo "  - bioconda" >> ~/.condarc
  - cat ~/.condarc

stages:
  - Test

TEST-00:
  stage: Test
  script:
    - make clean test_00

# TEST-01:
#   stage: Test
#   script:
#     - make clean test_01

TEST-02:
  stage: Test
  script:
    - make clean test_02
  